<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S26T6U199">x</span>,<span class="var type1" id="S27T3U200">P</span>] = kalman_update(<span class="var type1" id="S28T3U203">F</span>,<span class="var type1" id="S29T4U204">H</span>,<span class="var type1" id="S30T3U205">Q</span>,<span class="var type1" id="S31T2U206">R</span>,<span class="var type1" id="S32T2U207">obs</span>,<span class="var type1" id="S26T6U208">x</span>,<span class="var type1" id="S27T3U209">P</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line"><span class="mxinfo " id="T2:U10"><span class="var type1" id="S33T2U212">S</span> = <span class="mxinfo " id="T2:U12"><span class="mxinfo " id="T2:U13"><span class="mxinfo " id="T4:U14"><span class="var type1" id="S29T4U216">H</span>*<span class="var type1" id="S27T3U217">P</span></span>*<span class="mxinfo " id="T6:U17"><span class="var type1" id="S29T4U219">H</span>'</span></span>+<span class="var type1" id="S31T2U220">R</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line"><span class="mxinfo " id="T6:U20"><span class="var type1" id="S34T6U223">K</span> = <span class="mxinfo " id="T6:U22"><span class="mxinfo " id="T3:U23"><span class="var type1" id="S28T3U226">F</span>*<span class="var type1" id="S27T3U227">P</span></span>*<span class="mxinfo " id="T6:U26"><span class="var type1" id="S29T4U229">H</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line"><span class="mxinfo " id="T6:U28"><span class="var type1" id="S34T6U232">K</span> = <span class="mxinfo " id="T6:U30"><span class="var type1" id="S34T6U234">K</span>/<span class="var type1" id="S33T2U235">S</span></span></span>; <span class="comment">% Kalman gain</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line"><span class="mxinfo " id="T6:U33"><span class="var type1" id="S26T6U238">x</span> = <span class="mxinfo " id="T6:U35"><span class="mxinfo " id="T6:U36"><span class="var type1" id="S28T3U241">F</span>*<span class="var type1" id="S26T6U242">x</span></span>+<span class="mxinfo " id="T6:U39"><span class="var type1" id="S34T6U244">K</span>*(<span class="mxinfo " id="T2:U41"><span class="var type1" id="S32T2U247">obs</span>-<span class="mxinfo " id="T2:U43"><span class="var type1" id="S29T4U249">H</span>*<span class="var type1" id="S26T6U250">x</span></span></span>)</span></span></span>; <span class="comment">% state estimate</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72">72</a></span><span class="line"><span class="mxinfo " id="T3:U46"><span class="var type1" id="S35T3U253">Temp</span> = <span class="mxinfo " id="T3:U48"><span class="var type1" id="S28T3U255">F</span>-<span class="mxinfo " id="T3:U50"><span class="var type1" id="S34T6U257">K</span>*<span class="var type1" id="S29T4U258">H</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73">73</a></span><span class="line"><span class="mxinfo " id="T3:U53"><span class="var type1" id="S27T3U261">P</span> = <span class="mxinfo " id="T3:U55"><span class="mxinfo " id="T3:U56"><span class="var type1" id="S35T3U264">Temp</span>*<span class="var type1" id="S27T3U265">P</span></span>*<span class="mxinfo " id="T3:U59"><span class="var type1" id="S35T3U267">Temp</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74">74</a></span><span class="line"><span class="mxinfo " id="T3:U61"><span class="var type1" id="S27T3U270">P</span> = <span class="mxinfo " id="T3:U63"><span class="mxinfo " id="T3:U64"><span class="var type1" id="S27T3U273">P</span>+<span class="var type1" id="S30T3U274">Q</span></span>+<span class="mxinfo " id="T3:U67"><span class="mxinfo " id="T6:U68"><span class="var type1" id="S34T6U277">K</span>*<span class="var type1" id="S31T2U278">R</span></span>*<span class="mxinfo " id="T4:U71"><span class="var type1" id="S34T6U280">K</span>'</span></span></span></span>; <span class="comment">% MSE estimate</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75">75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76">76</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
